<!-- Copyright 2016 IPCO 2012 Limited

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->

<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Zapp Merchant Button</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <style type="text/css">
            body, html{
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
            }
            #payByZapp
            {
                position: absolute;
                /* background-color: #460f10; */
                width: 100%;
                height: 90%;
                cursor: pointer;
                border-radius: 10px;
                text-align: center;
            }
            #payByZapp > div
            {
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                position: absolute;
                width: 100%;
                height: 100%;
            }
            #payByZapp div.left
            {
                display: inline-block;
                /*updated width from 55 to 100 */
                width: 100%;
                height: 100%;
                position: absolute;
                left: 0;
                top: 0;
                text-align: center;
                /* overflow: hidden; */
                overflow: hidden;
                opacity: 0; 
            }
            #pbbaSpan
            {
                /* width: 75%; */
                width: 100%;
                height: 55%;
                /* background: url(pay-with.png) no-repeat center center; */
                background: url(../images/button_pbba.png) no-repeat center center;
                background-size: contain;
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                margin: auto;
            }
            #payByZapp div.right
            {
                display: block;
                width: 45%;
                height: 100%;
                position: absolute;
                right: 0;
                top: 0;
            }
            #payByZapp div.right > span
            {
                display: block;
                background: url(../images/zapp.png) no-repeat center center;
                background-size: contain;
                width: 75%;
                height: 55%;
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                margin: auto;
            }

            #payByZapp.default div.left
            {
                /* background-image: url(button-background-left.png); */
                background-position: right center;
                background-size: auto 100%;
                background-repeat: no-repeat;
                border-radius: 5px;
                opacity: 0;
            }

            #payByZapp.custom div.left,
            #payByZapp.custom div.right
            {
                width: 50%;
            }

            #payByZapp.custom div.left span
            {
                width: 90%;
                background-position: right center;
            }

            #payByZapp.loading div.left > span
            {
                display: none;
            }

            #payByZapp div.left #spinner
            {
                display: none;
            }

            #payByZapp.loading div.left #spinner
            {
                display: block;
                background: url(../images/PBBA_Loader_118x19_02.gif) no-repeat center center;
                bottom: 0;
			    height: 55%;
			    left: 0;
			    margin: auto;
			    position: absolute;
			    right: 0;
			    top: 0;
			    width: 100%;
            }

            #spinner
            {
                position: absolute;
                width: 120px;
                height: 120px;
            }

        </style>
        <script type="text/javascript" src="../js/extras.js"></script>
    </head>
    <body>
    	<!-- <a id="payByZapp"><div><div class="left"><span></span><div id="spinner"></div></div><div class="right"><span></span></div></div></a> -->
        <a id="payByZapp"><div><div id="left" class="left"><span id="pbbaSpan"></span><div id="spinner"></div></div></div></a>
        <script type="text/javascript">

            !function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h});

            var defaultImgSrc = "../images/pay-with-zapp.png";

            var enabled = true;

            zapp.bindEvent("message", function(ev) {

                var button = null;

                try {
                    data = JSON.parse(ev.data);
                    button = document.getElementById('payByZapp');
                } catch (err) {
                    return;
                }

                if (typeof data.eventType === "undefined" || data.eventType.indexOf("com.zapp.button") == -1)
                    return;

                switch (data.eventType)
                {
                    case "com.zapp.button.stop":
                    {
                        if (button.getAttribute("class") == null)
                            break;
                        button.setAttribute("class", button.getAttribute("class").replace(" loading", ""));
                        break;
                    }
                    case "com.zapp.button.disable":
                    {
                        enabled = false;
                        button.style.opacity = 0.2;
                        break;
                    }
                    case "com.zapp.button.enable":
                    {
                        enabled = true;
                        button.style.opacity = 1.0;
                        break;
                    }
                    default:
                    {
                        //alert('Unknown : ' + data.eventType);
                    }
                }

            });

            function addSpinner()
            {

                var buttonHeight = document.getElementsByTagName("body")[0].clientHeight;
                var height = (buttonHeight / 120) * 0.75;

                var topOffset = (buttonHeight - 120) * 0.5;

                var leftWidth = document.getElementById("spinner").parentNode.clientWidth;
                var leftOffset = (leftWidth - 120) * 0.5;

                var target = document.getElementById('spinner');
               // target.setAttribute('style', "transform: translate(" + leftOffset + "px, " + topOffset + "px) scale(" + height + ", " + height + "); -ms-transform: translate(" + leftOffset + "px, " + topOffset + "px) scale(" + height + ", " + height + "); -webkit-transform: translate(" + leftOffset + "px, " + topOffset + "px) scale(" + height + ", " + height + ");");
				target.setAttribute('style','url(../images/PBBA_Loader_118x19_02.gif) no-repeat center center');
//                filter: progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11=1.5320888862379554, M12=-1.2855752193730787, M21=1.2855752193730796, M22=1.5320888862379558);

                /* var opts = {
                    lines: 10, // The number of lines to draw
                    length: 20, // The length of each line
                    width: 15, // The line thickness
                    radius: 25, // The radius of the inner circle
                    corners: 1, // Corner roundness (0..1)
                    rotate: 0, // The rotation offset
                    direction: 1, // 1: clockwise, -1: counterclockwise
                    color: '#FFF', // #rgb or #rrggbb or array of colors
                    speed: 1, // Rounds per second
                    trail: 60, // Afterglow percentage
                    shadow: false, // Whether to render a shadow
                    hwaccel: false, // Whether to use hardware acceleration
                    className: 'spinner', // The CSS class to assign to the spinner
                    zIndex: 2e9, // The z-index (defaults to 2000000000)
                    top: '50%', // Top position relative to parent
                    left: '50%' // Left position relative to parent
                };
                var spinner = new Spinner(opts).spin(target);
 */
 
            }

            zapp.documentReady(function() {

               /*addSpinner();*/

                var button = document.getElementById('payByZapp');
                var pbbaSpan = document.getElementById('pbbaSpan');
                var left = document.getElementById('left');
                var newImgSrc = zapp.getParameterByName('src');
                var imageKey = zapp.getParameterByName('imageKey');

                var style = [];
                if ((newImgSrc != "undefined" && newImgSrc != "") )
                    style.push("background: url(" + newImgSrc + ") no-repeat center center");
                if (imageKey != "undefined" && imageKey != "" && imageKey > 1) {
                	style.push("height: 90%");
                	style.push("width: 90%");
                	style.push("background-size: contain");
                	switch (parseInt(imageKey)) {
	                	case 2: left.style.setProperty("background-color", "#00af87");
	                			break;
	                	case 3: left.style.setProperty("background-color", "#fff");
	                			left.style.setProperty("width", "97%");
	                			left.style.setProperty("border", "2px solid #28b9f3");
	                			break;
	                	default: break;
                	}
                	/* left.style.setProperty("background-color", "transparent"); */
                } else {
                	left.style.setProperty("background-color", "#FF6E00");
                }
                left.style.setProperty("opacity", "1");
                var cornerRadius = zapp.getParameterByName('cornerRadius');
                if ((cornerRadius != "undefined" && cornerRadius != "") || (cornerRadius != "" && cornerRadius == 0))
                    style.push("border-radius: " + cornerRadius + "px");
                var backgroundColor = zapp.getParameterByName('backgroundColor');
                if (backgroundColor != "undefined" && backgroundColor != "")
                    style.push("background-color: " + backgroundColor);

                /* if (style.length > 0)
                {
                    style.push("background-image: none");
                    button.setAttribute("class", "custom");
                }
                else */
                    button.setAttribute("class", "default");

                if (style != null)
                    pbbaSpan.setAttribute('style', style.join("; "));

                
                button.onclick = function() {
                	
                    if (button.getAttribute("class").indexOf("loading") == -1){
                    	if(imageKey == 1){
                    		button.setAttribute("class", button.getAttribute("class") + " loading");
                    	}
                    }
                    window.parent.postMessage("read-pbba-cookies", "*");
                    var postData = {
                        iframeID: zapppopup.getParameterByName('id'),
                        id: zapppopup.getParameterByName('id'),
                        pcid: zapppopup.getCookie('pcid'),
                        hasApp: zapppopup.getCookie('hasApp'),
                        eventType: 'com.zapp.button.click'
                    };
                    window.parent.postMessage(JSON.stringify(postData), '*');
                };
            });

        </script>
    </body>
</html>
